<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  {% load static %}
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Assigned Students | Mentor Mentee</title>

  <!-- STYLES -->
  <link rel="stylesheet" href="{% static '../static/styles/admin.css' %}" />
  <link rel="stylesheet" href="{% static '../static/styles/admin_ViewAssignments.css' %}" />

  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet" />
</head>

<body>

<!-- HEADER -->
<header class="header">
  <div class="header-left">
    <img src="{% static '../static/Assets/logo.png' %}" class="header-logo" />
    <div class="header-title">
      <h2 class="rcss-title">RCSS</h2>
      <p class="rcss-subtitle">RAJAGIRI COLLEGE OF SOCIAL SCIENCES (AUTONOMOUS)</p>
    </div>
  </div>

  <h1 class="main-title">MENTOR MENTEE</h1>

  <div class="header-right">
    <h3>{{ admin.name }}</h3>
    <div class="user-profile-icon">
      <img src="../static/admin_image/{{ admin.admin_image }}" alt="Admin">
    </div>
    <button onclick="location.href='{% url 'logout' %}'" class="logout-btn">Logout</button>
  </div>
</header>

<div class="container">

<!-- SIDEBAR (UNCHANGED) -->
<aside class="sidebar">
    <nav class="menu">

      <a class="menu-item" href="/admin_dashboard">
        <i class="fas fa-th-large"></i><span>Dashboard</span>
      </a>
      <hr class="menu-divider">

      <a class="menu-item" href="/admin_viewFaculty">
        <i class="fas fa-user"></i><span>View Faculty</span>
      </a>

      <hr class="menu-divider">

      <div class="dropdown">
        <a class="menu-item dropdown-toggle">
          <i class="fas fa-graduation-cap"></i><span>Students</span>
          <i class="fas fa-chevron-down dropdown-icon"></i>
        </a>
        <div class="dropdown-menu">
          <a class="dropdown-item" href="/admin_addStudent"><i class="fas fa-user-plus"></i>Add Student</a>
          <a class="dropdown-item" href="/admin_ViewStudents"><i class="fas fa-users"></i>View Students</a>
        </div>
      </div>
      <hr class="menu-divider">

            <div class="dropdown">
                <a class="menu-item dropdown-toggle">
                    <i class="fas fa-book"></i><span>Batches</span>
                    <i class="fas fa-chevron-down dropdown-icon"></i>
                </a>
                <div class="dropdown-menu">
                    <a class="dropdown-item active" href="/admin_addBatch"><i class="fas fa-plus"></i>Create Batch</a>
                    <a class="dropdown-item" href="/admin_viewBatches"><i class="fas fa-layer-group"></i>View Batches</a>
                </div>
            </div>

      <hr class="menu-divider">

      <div class="dropdown open">
        <a class="menu-item dropdown-toggle">
          <i class="fas fa-link"></i><span>Assignments</span>
          <i class="fas fa-chevron-down dropdown-icon"></i>
        </a>
        <div class="dropdown-menu">
          <a class="dropdown-item" href="/admin_AddAssignment"><i class="fas fa-user-plus"></i>Assign Student</a>
          <a class="dropdown-item active" href="/admin_ViewAssignments"><i class="fas fa-users"></i>View Assignments</a>
        </div>
      </div>

      <hr class="menu-divider">

      <div class="dropdown">
        <a class="menu-item dropdown-toggle">
          <i class="fas fa-link"></i><span>Mentoring Sessions</span>
          <i class="fas fa-chevron-down dropdown-icon"></i>
        </a>
        <div class="dropdown-menu">
          <a class="dropdown-item" href="/admin_createSession"><i class="fas fa-user-plus"></i>Create Session</a>
          <a class="dropdown-item" href="/admin_viewSessions"><i class="fas fa-users"></i>View Sessions</a>
        </div>
      </div>

      <hr class="menu-divider">

      <a class="menu-item" href="/admin_reports">
        <i class="fas fa-user"></i><span>Report</span>
      </a>

      <hr class="menu-divider">

      <a class="menu-item" href="/admin_profile">
        <i class="fas fa-user"></i><span>Profile</span>
      </a>

    </nav>
  </aside>

<!-- MAIN CONTENT -->
<main class="main-content">

<section class="students-section">

  <div class="students-header">
    <h2>Assigned Students</h2>
  </div>

  <!-- FILTERS -->
  <div class="students-filters">

    <div class="filter-row">
      <select id="facultySelect" class="students-filter">
        <option value="">Select Faculty</option>
        {% for f in faculties %}
        <option value="{{ f.faculty_id }}">{{ f.name }} — {{ f.designation }}</option>
        {% endfor %}
      </select>

      <select id="batchSelect" class="students-filter">
        <option value="">All Batches</option>
        {% for b in batches %}
        <option value="{{ b.batch_id }}">{{ b.batch_name }}</option>
        {% endfor %}
      </select>

      <button id="loadBtn" class="filter-btn">
        <i class="fas fa-filter"></i> Apply Filters
      </button>
    </div>

    <input type="text" id="searchInput" class="students-search full-search"
           placeholder="Search by name or Reg No" />
  </div>

  <!-- TABLE -->
  <div class="students-table-container">
    <table class="students-table">
      <thead>
        <tr>
          <th>Photo</th>
          <th>Name</th>
          <th>Reg. No</th>
          <th>Course</th>
          <th>Batch</th>
          <th>Faculty</th> <!-- ✅ NEW COLUMN -->
        </tr>
      </thead>
      <tbody id="studentsTableBody"></tbody>
    </table>
  </div>

</section>

</main>
</div>

<!-- JS -->
<script>
  const facultySelect = document.getElementById("facultySelect");
  const batchSelect = document.getElementById("batchSelect");
  const loadBtn = document.getElementById("loadBtn");
  const tableBody = document.getElementById("studentsTableBody");
  const searchInput = document.getElementById("searchInput");

  window.getAssignedURL = "{% url 'get_assigned_students' %}";

  document.addEventListener("DOMContentLoaded", loadStudents);
  loadBtn.addEventListener("click", loadStudents);

  function loadStudents() {
    let url = window.getAssignedURL + "?";
    if (facultySelect.value) url += "faculty=" + facultySelect.value + "&";
    if (batchSelect.value) url += "batch=" + batchSelect.value;

    fetch(url)
      .then(r => r.json())
      .then(d => renderTable(d.students));
  }

 function renderTable(students) {
  tableBody.innerHTML = "";

  if (!students.length) {
    tableBody.innerHTML = `
      <tr>
        <td colspan="6" style="text-align:center;color:#999">
          No students found
        </td>
      </tr>`;
    return;
  }

  students.forEach(s => {
    const img = s.student_image
      ? `/media/${s.student_image}`
      : "/static/Assets/default-user.png";

    tableBody.innerHTML += `
      <tr>
        <td>
          <div class="avatar-wrapper">
            <img src="${img}" class="table-avatar">
          </div>
        </td>
        <td>${s.name}</td>
        <td>${s.reg_no}</td>
        <td>${s.course_name}</td>
        <td>${s.batch_name}</td>
        <td>${s.faculty_name}</td>
      </tr>`;
  });
}

  searchInput.addEventListener("keyup", () => {
    const value = searchInput.value.toLowerCase();
    document.querySelectorAll("#studentsTableBody tr").forEach(row => {
      row.style.display = row.innerText.toLowerCase().includes(value) ? "" : "none";
    });
  });

  document.querySelectorAll('.dropdown-toggle').forEach(toggle => {
        toggle.addEventListener('click', function (e) {
      e.preventDefault();
      const dropdown = this.closest('.dropdown');
      dropdown.classList.toggle('open');
    });
  });
</script>
</body>
</html>
