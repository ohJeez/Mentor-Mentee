{% load static %}
{% include 'Faculty/header.html' %}

    <link rel="stylesheet" href="{% static 'styles/admin.css' %}">
    <link rel="stylesheet" href="{% static 'styles/admin_dashboard.css' %}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/fullcalendar/6.1.8/index.global.min.css" rel="stylesheet">

<style>
.info-header {
    display: flex;
    align-items: center;
    gap: 10px;      /* space between icon and text */
}

.info-header i {
    font-size: 22px;
    color: #28a745; /* optional */
}

.info-header h3 {
    margin: 0;
    font-size: 16px;
}

</style>

<div class="container">

    <!-- SIDEBAR -->
    <aside class="sidebar">
        <nav class="menu">
            <a href="{% url 'faculty_dashboard' %}" class="menu-item active">
                <i class="fas fa-th-large"></i> <span>Dashboard</span>
            </a>

            <hr class="menu-divider" />

            <div class="dropdown">
                <a class="menu-item dropdown-toggle">
                <i class="fas fa-graduation-cap"></i><span>Students</span>
                <i class="fas fa-chevron-down dropdown-icon"></i>
                </a>
                <div class="dropdown-menu">
                <a class="dropdown-item" href="{% url 'students-content' %}"><i class="fas fa-user"></i>My Students</a>
                <a class="dropdown-item" href="{% url 'students-view' %}"><i class="fas fa-users"></i>All Students</a>
                </div>
            </div>

            <hr class="menu-divider" />

            <a href="{% url 'faculty_session_requests' %}" class="menu-item">
                <i class="fas fa-file-alt"></i> <span>Session Requests</span>
            </a>

            <hr class="menu-divider" />

            <a href="{% url 'profile_content' %}" class="menu-item">
                <i class="fas fa-user"></i> <span>Profile</span>
            </a>
        </nav>
    </aside>

<!-- MAIN CONTENT -->
<main class="main-content">

    <!-- WELCOME -->
    <div class="welcome-section">
        <p>Welcome <strong>{{ faculty.name }}</strong></p>
    </div>

    <div style="display:flex; width:100%; gap:20px;">

        <!-- CALENDAR -->
        <div class="calendar-card">
            <div id="calendar"></div>
        </div>

        <!-- RIGHT SIDE PANEL -->
        <div class="side-info">

            <div class="info-box">
                <div class="info-header">
                    <i class="fa-solid fa-calendar-check"></i>
                    <h3>Active Sessions</h3>
                </div>

                {% if active_sessions %}
                    <div>
                        {% for s in active_sessions %}
                            <div style="margin-bottom: 10px;"><strong>{{ s.batch.batch_name }}</strong> <br>  {{ s.start_date }} to {{ s.end_date }}</div>
                        {% endfor %}
                    </div>
                {% else %}
                    <p>No active sessions.</p>
                {% endif %}
            </div>

            <div class="info-box">
                <div class="info-header">
                    <i class="fa-solid fa-calendar-plus"></i>
                    <h3>Upcoming Sessions</h3>
                </div>

                {% if pending_sessions %}
                    <div>
                        {% for s in pending_sessions %}
                            <div style="margin-bottom: 10px;"><strong>{{ s.batch.batch_name }}</strong> <br> Starts {{ s.start_date }}</div>
                        {% endfor %}
                    </div>
                {% else %}
                    <p>No upcoming sessions.</p>
                {% endif %}
            </div>

        </div>
    </div>

</main>
</div>


<!-- JS -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/fullcalendar/6.1.8/index.global.min.js"></script>

<script>
document.addEventListener("DOMContentLoaded", function () {

    var calendar = new FullCalendar.Calendar(document.getElementById("calendar"), {
        initialView: "dayGridMonth",
        height: 650,
        events: "/faculty/get_sessions/",
        dateClick: loadDay,
        eventClick: loadDay
    });

    function loadDay(info) {
        let date = info.dateStr || info.event.startStr;

        fetch(`/faculty/get_day_sessions/${date}`)
        .then(res => res.json())
        .then(data => {
            document.getElementById("modal-date").innerHTML = date;
            let ul = document.getElementById("modal-session-list");
            ul.innerHTML = "";

            if (data.length === 0) {
                ul.innerHTML = "<li>No sessions scheduled.</li>";
            } else {
                data.forEach(item => {
                    ul.innerHTML += `<li>${item.batch} â€“ ${item.status}</li>`;
                });
            }
            document.getElementById("sessionModal").style.display = "flex";
        });
    }

    calendar.render();
});
</script>
<script>
  // Dropdown
  document.querySelectorAll('.dropdown-toggle').forEach(el => {
    el.addEventListener('click', () => {
      el.parentNode.classList.toggle('open');
    });
  });

  // Modal
  const modal = document.getElementById("editModal");
  document.getElementById("openEditModal").onclick = () => modal.style.display = "flex";
  document.getElementById("closeEditModal").onclick = () => modal.style.display = "none";
</script>

</body>
</html>
