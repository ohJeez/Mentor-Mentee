{% load static %}

{% include 'Faculty/header.html' %}

<link rel="stylesheet" href="{% static 'css/sessions.css' %}">

<style>
.documents-row {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 20px;
}

/* reduce height */
.document-card {
    padding: 14px 16px;
    position: relative;
    min-height: 70px;
}

.doc-row {
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.doc-left {
    display: flex;
    align-items: center;
    gap: 10px;
}

.doc-title {
    font-weight: 600;
    font-size: 14.5px;
}

/* ===== Upload dropdown overlay ===== */
.uploads-card {
    position: relative;
    z-index: 50;   /* create higher stacking context */
}

.uploads-dropdown {
    position: absolute;
    top: 100%;
    left: 0;
    width: 100%;
    background: white;
    border-radius: 10px;
    box-shadow: 0 12px 28px rgba(0,0,0,0.15);
    margin-top: 8px;
    padding: 10px 14px;
    display: none;
    z-index: 9999;   /* VERY IMPORTANT */
    max-height: 220px;
    overflow-y: auto;
}


.uploads-dropdown.open {
    display: block;
}

.uploads-dropdown ul {
    list-style: none;
    padding: 0;
    margin: 0;
}

.uploads-dropdown li a {
    display: block;
    padding: 6px 0;
    font-size: 13px;
    color: #2563eb;
    text-decoration: none;
}

.uploads-dropdown li a:hover {
    text-decoration: underline;
}

.dropdown-arrow {
    transition: transform 0.25s;
}

.dropdown-arrow.rotate {
    transform: rotate(180deg);
}
</style>

<!-- PAGE BODY -->
<div class="container">

    <!-- SIDEBAR -->
    <aside class="sidebar">
        <nav class="menu">
            <a href="{% url 'faculty_dashboard' %}" class="menu-item">
                <i class="fas fa-th-large"></i> <span>Dashboard</span>
            </a>

            <hr class="menu-divider" />

            <div class="dropdown">
                <a class="menu-item dropdown-toggle">
                <i class="fas fa-graduation-cap"></i><span>Students</span>
                <i class="fas fa-chevron-down dropdown-icon"></i>
                </a>
                <div class="dropdown-menu">
                <a class="dropdown-item" href="{% url 'students-content' %}"><i class="fas fa-user"></i>My Students</a>
                <a class="dropdown-item" href="{% url 'students-view' %}"><i class="fas fa-users"></i>All Students</a>
                </div>
            </div>

            <hr class="menu-divider" />

            <a href="{% url 'faculty_session_requests' %}" class="menu-item">
                <i class="fas fa-file-alt"></i> <span>Session Requests</span>
            </a>

            <hr class="menu-divider" />

            <a href="{% url 'profile_content' %}" class="menu-item">
                <i class="fas fa-user"></i> <span>Profile</span>
            </a>
        </nav>
    </aside>

  <!-- MAIN CONTENT -->
  <main class="main-content">

    <span>Mentoring Sessions for <b>{{ student.name }}</b></span>

    <!-- QUICK STATS -->
    <div class="students-stats">
      <div class="stat-card">
        <div class="stat-icon"><i class="fas fa-users"></i></div>
        <div>
          <h4>Total Mentoring</h4>
          {% if sessions|length > 0 %}
            <p>{{ sessions|length }} Completed</p>
          {% else %}
            <p>No Mentoring Attended</p>
          {% endif %}
        </div>
      </div>

      <div class="stat-card">
        <div class="stat-icon"><i class="fas fa-calendar-check"></i></div>
        <div>
          <h4>Last Session</h4>
          {% if sessions %}
            <p>{{ sessions.0.date|date:"d M Y" }}</p>
          {% else %}
            <p>No sessions</p>
          {% endif %}
        </div>
      </div>

      <div class="stat-card">
        <div class="stat-icon"><i class="fas fa-clock"></i></div>
        <div>
          <h4>Next Meeting</h4>
          <p>Not Scheduled</p>
        </div>
      </div>
    </div>

    <div class="documents-row">

      <!-- Application Form -->
      <div class="document-card glass">
        <div class="doc-row">
          <div class="doc-left">
            <div class="doc-icon pdf"><i class="fas fa-file-pdf"></i></div>
            <span class="doc-title">Application Form</span>
          </div>
          <div class="doc-right">
            {% if student.application_form %}
              <a href="{{ student.application_form.url }}" target="_blank" class="doc-btn">
                <i class="fas fa-eye"></i> View
              </a>
            {% else %}
              <span class="no-doc">Not Uploaded</span>
            {% endif %}
          </div>
        </div>
      </div>

      <!-- Assessment File -->
      <div class="document-card glass">
        <div class="doc-row">
          <div class="doc-left">
            <div class="doc-icon pdf"><i class="fas fa-file-alt"></i></div>
            <span class="doc-title">Assessment File</span>
          </div>
          <div class="doc-right">
            {% if student.assessment_file %}
              <a href="{{ student.assessment_file.url }}" target="_blank" class="doc-btn">
                <i class="fas fa-eye"></i> View
              </a>
            {% else %}
              <span class="no-doc">Not Uploaded</span>
            {% endif %}
          </div>
        </div>
      </div>

      <!-- Student Uploads -->
      <div class="document-card glass uploads-card">
        <div class="doc-row clickable" onclick="toggleUploads()">
          <div class="doc-left">
            <div class="doc-icon upload">
              <i class="fas fa-cloud-upload-alt"></i>
            </div>
            <span class="doc-title">Student Uploads</span>
          </div>
          <i class="fas fa-chevron-down dropdown-arrow"></i>
        </div>

        <!-- DROPDOWN (overlay, not expanding card) -->
        <div id="uploadsList" class="uploads-dropdown">
          {% if student_uploads %}
            <ul class="upload-list">
              {% for upload in student_uploads %}
                <li>
                  <a href="{{ upload.upload_file.url }}" target="_blank">
                    <i class="fas fa-paperclip"></i>
                    {{ upload.file_name|default:upload.upload_file.name }}
                  </a>
                </li>
              {% endfor %}
            </ul>
          {% else %}
            <span class="no-doc">No uploads yet</span>
          {% endif %}
        </div>
      </div>

    </div>

    <br>

    <!-- NEW SESSION -->
    <div class="new-session-container">
      <a href="{% url 'new_session' student.student_id %}" class="view-btn">
        New Session
      </a>
    </div>

    <!-- SESSIONS TABLE -->
    <div class="students-table-container">
      <table class="students-table">
        <thead>
          <tr>
            <th>Date</th>
            <th>Title</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          {% for session in sessions %}
          <tr>
            <td>{{ session.date }}</td>
            <td>{{ session.title }}</td>
            <td>
              <a href="{% url 'view_session' session.session_id %}" class="view-btn">
                View Details
              </a>
            </td>
          </tr>
          {% empty %}
          <tr>
            <td colspan="3">No sessions yet.</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>

  </main>
</div>

<script>
  // Dropdown
  document.querySelectorAll('.dropdown-toggle').forEach(el => {
    el.addEventListener('click', () => {
      el.parentNode.classList.toggle('open');
    });
  });

  // Modal
  const modal = document.getElementById("editModal");
  document.getElementById("openEditModal").onclick = () => modal.style.display = "flex";
  document.getElementById("closeEditModal").onclick = () => modal.style.display = "none";
</script>
<script>
function toggleUploads() {
    const list = document.getElementById("uploadsList");
    const arrow = document.querySelector(".dropdown-arrow");

    list.classList.toggle("open");
    arrow.classList.toggle("rotate");
}
</script>



{% comment %}{% include 'Faculty/footer.html' %}{% endcomment %}
