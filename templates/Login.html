<!DOCTYPE html>
<html lang="en">
<head>
  {% load static %}
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Mentor Mentee | Login</title>

  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"/>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>


  <style>
    :root {
      --primary-green: #28a745;
      --dark-green: #218838;
      --text-dark: #1b1b1b;
      --border: #dcdcdc;
      --light-bg: #f8f9fa;
      --signup-bg: #eef8ef;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: "Poppins", sans-serif;
    }

    body {
      background: var(--light-bg);
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      padding: 20px;
    }

    .login-card {
      background: #fff;
      width: 100%;
      max-width: 430px;
      padding: 2.5rem 2rem;
      border-radius: 14px;
      box-shadow: 0 8px 28px rgba(0,0,0,0.12);
      text-align: center;
    }

    .login-logo {
      width: 85px;
      height: 85px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 0 auto 1rem;
    }

    .login-logo img {
      width: 63px;
      border-radius: 50%;
    }

    h1 {
      color: var(--text-dark);
      font-size: 2rem;
      font-weight: 700;
      margin-bottom: 1.8rem;
      letter-spacing: 1px;
    }

    .input-group {
      position: relative;
      margin-bottom: 1.4rem;
    }

    .input-field {
      width: 100%;
      padding: 15px 48px 15px 18px;
      font-size: 0.95rem;
      border-radius: 10px;
      border: 1.5px solid var(--border);
      background: #fff;
      transition: 0.3s ease;
    }

    .input-field:focus {
      outline: none;
      border-color: var(--primary-green);
      box-shadow: 0 0 5px rgba(40,167,69,0.4);
    }

    .input-icon {
      position: absolute;
      right: 18px;
      top: 50%;
      transform: translateY(-50%);
      color: gray;
      font-size: 1.05rem;
      cursor: pointer;
    }

    .forgot-password {
      text-align: right;
      margin-bottom: 1.8rem;
    }

    .forgot-password a {
      color: var(--primary-green);
      font-size: 0.9rem;
      text-decoration: none;
      font-weight: 500;
    }

    .forgot-password a:hover {
      text-decoration: underline;
    }

    .login-btn {
      width: 100%;
      padding: 14px;
      background: var(--primary-green);
      color: #fff;
      border: none;
      border-radius: 10px;
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      transition: 0.3s ease;
      margin-bottom: 1rem;
    }

    .login-btn:hover {
      background: var(--dark-green);
    }

    /* Sign Up Button */
    .signup-btn {
      width: 100%;
      padding: 12px;
      background: var(--signup-bg);
      border: 1.5px solid var(--primary-green);
      border-radius: 10px;
      font-size: 0.95rem;
      font-weight: 600;
      cursor: pointer;
      color: var(--primary-green);
      transition: 0.3s ease;
    }

    .signup-btn:hover {
      background: #dff0e0;
    }

    .footer-note {
      margin-top: 1.8rem;
      font-size: 0.83rem;
      color: gray;
    }

    /* ================= MODAL CORE ================= */
.modal {
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.55);
  display: none;
  align-items: center;
  justify-content: center;
  z-index: 9999;
}

.modal-content {
  background: #ffffff;
  width: 90%;
  max-width: 380px;
  padding: 22px 24px;
  border-radius: 14px;
  box-shadow: 0 15px 40px rgba(0,0,0,0.25);
  animation: modalFade 0.25s ease;
}

@keyframes modalFade {
  from { opacity: 0; transform: scale(0.95); }
  to   { opacity: 1; transform: scale(1); }
}

.modal-header {
  font-size: 1.05rem;
  font-weight: 600;
  margin-bottom: 14px;
  display: flex;
  align-items: center;
  gap: 8px;
}

.modal-body label {
  font-size: 0.85rem;
  font-weight: 500;
}

.modal-body input {
  width: 100%;
  padding: 10px 12px;
  margin-top: 6px;
  border-radius: 8px;
  border: 1px solid var(--border);
}

.modal-actions {
  margin-top: 16px;
  display: flex;
  justify-content: flex-end;
  gap: 10px;
}

.cancel-btn {
  background: #e5e7eb;
  border: none;
  padding: 8px 14px;
  border-radius: 8px;
  cursor: pointer;
}

.save-btn {
  background: var(--primary-green);
  color: #fff;
  border: none;
  padding: 8px 14px;
  border-radius: 8px;
  cursor: pointer;
}

.otp-box{
  width:50px;
  height:52px;
  text-align:center;
  font-size:20px;
  font-weight:700;
  border-radius:12px;
  border:1.5px solid #d1d5db;
  transition:0.25s;
}

.otp-box:focus{
  outline:none;
  border-color:#28a745;
  box-shadow:0 0 0 3px rgba(40,167,69,.2);
}

/* ===== PASSWORD FORM STYLES ===== */
.form-group{
  margin-bottom:18px;
}

.form-group label{
  display:block;
  font-size:13px;
  font-weight:600;
  margin-bottom:6px;
  color:#374151;
}

.input-wrapper{
  position:relative;
  display:flex;
  align-items:center;
}

.input-wrapper input{
  width:100%;
  padding:12px 42px 12px 42px;
  border-radius:10px;
  border:1.5px solid #d1d5db;
  font-size:14px;
  transition:0.25s;
}

.input-wrapper input:focus{
  outline:none;
  border-color:var(--primary-green);
  box-shadow:0 0 0 3px rgba(40,167,69,.18);
}

.input-icon-left{
  position:absolute;
  left:14px;
  color:#6b7280;
  font-size:14px;
}

.toggle-eye{
  position:absolute;
  right:14px;
  color:#6b7280;
  cursor:pointer;
  font-size:15px;
}

.toggle-eye:hover{
  color:var(--primary-green);
}

.swal2-container {
  z-index: 100000 !important;
}


  </style>
</head>

<body>

  <div class="login-card">

    <form method="post">
      {% csrf_token %}

      <div class="login-logo">
        <img src="{% static '../static/Assets/logo.png' %}" alt="RCSS Logo" />
      </div>

      <h1>MENTOR MENTEE</h1>

      <!-- Username -->
      <div class="input-group">
        <input type="text" class="input-field" placeholder="Username" name="uname" required>
        <i class="fas fa-user input-icon"></i>
      </div>

      <!-- Password -->
      <div class="input-group">
        <input type="password" class="input-field" placeholder="Password" id="password" name="password" required>
        <i class="fas fa-eye input-icon" id="togglePassword" style="cursor:pointer;"></i>
      </div>

      <div class="forgot-password">
        <a onclick="openForgotModal()">Forgot Password?</a>
      </div>

      <button type="submit" class="login-btn">Sign In</button>
    </form>

    <!-- Signup Button -->
    <button class="signup-btn" onclick="window.location.href='/signup'">
      <i class="fas fa-user-plus"></i> Create New Account
    </button>

    <!-- <p class="footer-note">Internal use only â€” secure login required.</p> -->

  </div>

  <!-- ===== Forgot Password Modal ===== -->
<div class="modal" id="forgotModal" style="display:none;">
  <div class="modal-content" style="max-width:440px;padding:28px 30px;">

    <div class="modal-header" style="font-size:1.15rem;font-weight:600;">
      <i class="fas fa-envelope"></i>
      Forgot Password
    </div>

    <div class="modal-body">

      <p style="
        font-size:14px;
        color:#4b5563;
        margin-bottom:16px;
        line-height:1.5;
      ">
        Enter your <strong>Rajagiri official email ID</strong>.<br>
        A <strong>4-digit OTP</strong> will be sent to this email for verification.
      </p>

      <label style="font-size:13px;font-weight:600;">
        Rajagiri Email ID
      </label>

      <input
        type="email"
        id="forgotEmail"
        placeholder="example@rajagiri.edu.in"
        style="margin-top:6px;"
        required
      >

    </div>

    <div class="modal-actions">
      <button class="cancel-btn" onclick="closeForgotModal()">Cancel</button>
      <button class="save-btn" onclick="openOTPModal()">Send OTP</button>
    </div>

  </div>
</div>



<!-- ===== OTP Verification Modal ===== -->
<div class="modal" id="otpModal" style="display:none;">
  <div class="modal-content" style="
      max-width:420px;
      padding:30px 32px;
      border-radius:18px;
      box-shadow:0 20px 60px rgba(0,0,0,.25);
  ">

    <!-- Header -->
    <div class="modal-header" style="
        display:flex;
        align-items:center;
        gap:10px;
        font-size:1.2rem;
        font-weight:700;
        color:#28a745;
        margin-bottom:16px;
    ">
      <i class="fas fa-key"></i>
      OTP Verification
    </div>

    <!-- Body -->
    <div class="modal-body">

      <p style="
        font-size:14px;
        color:#4b5563;
        text-align:center;
        margin-bottom:22px;
        line-height:1.5;
      ">
        Please enter the <strong>4-digit OTP</strong> sent to your
        <strong>Rajagiri email address</strong>.
      </p>

      <!-- OTP Boxes -->
      <div style="
        display:flex;
        gap:14px;
        justify-content:center;
      ">
        <input class="otp-box" maxlength="1" inputmode="numeric">
        <input class="otp-box" maxlength="1" inputmode="numeric">
        <input class="otp-box" maxlength="1" inputmode="numeric">
        <input class="otp-box" maxlength="1" inputmode="numeric">
      </div>

    </div>

    <!-- Actions -->
    <div class="modal-actions" style="
        margin-top:26px;
        display:flex;
        justify-content:space-between;
        gap:12px;
    ">
      <button class="cancel-btn" onclick="closeOTPModal()">Cancel</button>
      <button class="save-btn" onclick="verifyOTP()">Verify OTP</button>
    </div>

  </div>
</div>

<!-- ===========================New Password Modal======================== -->
 <div class="modal" id="newPasswordModal">
  <div class="modal-content" style="max-width:440px;padding:30px 32px;">

    <!-- Header -->
    <div class="modal-header" style="
      display:flex;
      align-items:center;
      gap:10px;
      font-size:1.2rem;
      font-weight:700;
      color:var(--primary-green);
      margin-bottom:18px;
    ">
      <i class="fas fa-key"></i>
      Set New Password
    </div>

    <!-- Body -->
    <div class="modal-body">

      <p style="
        font-size:14px;
        color:#4b5563;
        margin-bottom:22px;
        line-height:1.5;
      ">
        Create a strong password for your account.<br>
        Make sure both passwords match.
      </p>

      <!-- New Password -->
      <div class="form-group">
        <label>New Password</label>
        <div class="input-wrapper">
          <i class="fas fa-lock input-icon-left"></i>
          <input type="password"
                 id="newPassword"
                 placeholder="Enter new password">
          <i class="fas fa-eye toggle-eye"
             onclick="togglePassword(this, 'newPassword')"></i>
        </div>
      </div>

      <!-- Confirm Password -->
      <div class="form-group">
        <label>Confirm Password</label>
        <div class="input-wrapper">
          <i class="fas fa-lock input-icon-left"></i>
          <input type="password"
                 id="confirmPassword"
                 placeholder="Re-enter new password">
          <i class="fas fa-eye toggle-eye"
             onclick="togglePassword(this, 'confirmPassword')"></i>
        </div>
      </div>

    </div>

    <!-- Actions -->
    <div class="modal-actions" style="margin-top:26px;">
      <button class="cancel-btn" onclick="closeNewPasswordModal()">Cancel</button>
      <button class="save-btn" onclick="saveNewPassword()">Save Password</button>
    </div>

  </div>
</div>




  

  <!-- Toggle password -->
  <script>
    const toggle = document.getElementById("togglePassword");
    const password = document.getElementById("password");

    toggle.addEventListener("click", () => {
      const type = password.type === "password" ? "text" : "password";
      password.type = type;

      toggle.classList.toggle("fa-eye");
      toggle.classList.toggle("fa-eye-slash");
    });

    /* ================= MODAL HELPERS ================= */
function openModal(id){
  document.getElementById(id).style.display = "flex";
}
function closeModal(id){
  document.getElementById(id).style.display = "none";
}

/* ================= FORGOT PASSWORD ================= */
function openForgotModal(){
  openModal("forgotModal");
}

function closeForgotModal(){
  closeModal("forgotModal");
}

/* ================= SEND OTP ================= */
function openOTPModal(){
  const email = document.getElementById("forgotEmail").value.trim();

  if(!email){
    alert("Please enter your email");
    return;
  }

  fetch("/login_send_otp/",{
    method:"POST",
    headers:{
      "X-CSRFToken":"{{ csrf_token }}",
      "Content-Type":"application/json"
    },
    body:JSON.stringify({ email })
  })
  .then(res=>res.json())
  .then(data=>{
    if(data.status==="sent"){
      closeForgotModal();
      openModal("otpModal");
      clearOTP();
    }else{
      closeModal("forgotModal");
      Swal.fire({
        icon: "error",
        title: "OTP Failed",
        text: data.message || "Unable to send OTP. Please try again.",
        confirmButtonColor: "#28a745",
        allowOutsideClick: false
      });
    }
  });
}

/* ================= OTP HANDLING ================= */
const otpInputs = document.querySelectorAll(".otp-box");

otpInputs.forEach((input, index) => {

  input.addEventListener("input", () => {
    if (input.value && index < otpInputs.length - 1) {
      otpInputs[index + 1].focus();
    }
  });

  input.addEventListener("keydown", e => {
    if (e.key === "Backspace" && !input.value && index > 0) {
      otpInputs[index - 1].focus();
    }
  });

});

function clearOTP(){
  otpInputs.forEach(i => i.value="");
  otpInputs[0].focus();
}

function verifyOTP(){
  let otp="";
  otpInputs.forEach(i => otp+=i.value);

  if(otp.length !== 4){
    alert("Enter 4-digit OTP");
    return;
  }

  fetch("/login_verify_otp/",{
    method:"POST",
    headers:{
      "X-CSRFToken":"{{ csrf_token }}",
      "Content-Type":"application/json"
    },
    body:JSON.stringify({ otp })
  })
  .then(res=>res.json())
  .then(data=>{
    if(data.status==="success"){
      closeModal("otpModal");
      openModal("newPasswordModal");
    }else{
      Swal.fire({
        icon: "error",
        title: "Invalid OTP",
        text: "The OTP you entered is incorrect. Please try again.",
        confirmButtonColor: "#28a745",
        allowOutsideClick: false
      });
      clearOTP();
    }
  });
}

function closeOTPModal(){
  closeModal("otpModal");
}

/* ================= PASSWORD RESET ================= */
function closeNewPasswordModal(){
  closeModal("newPasswordModal");
}

function togglePassword(icon, inputId){
  const input = document.getElementById(inputId);
  input.type = input.type === "password" ? "text" : "password";
  icon.classList.toggle("fa-eye");
  icon.classList.toggle("fa-eye-slash");
}

function saveNewPassword(){
  const p1 = document.getElementById("newPassword").value;
  const p2 = document.getElementById("confirmPassword").value;

  if(!p1 || !p2){
    Swal.fire({
      icon: "warning",
      title: "Incomplete Details",
      text: "Please fill in all required fields before continuing.",
      confirmButtonColor: "#28a745",
      allowOutsideClick: false
    });
    return;
  }
  if(p1 !== p2){
    Swal.fire({
      icon: "error",
      title: "Password Mismatch",
      text: "The passwords you entered do not match. Please try again.",
      confirmButtonColor: "#28a745",
      allowOutsideClick: false
    });

    return;
  }

  fetch("/reset_password/",{
    method:"POST",
    headers:{
      "X-CSRFToken":"{{ csrf_token }}",
      "Content-Type":"application/json"
    },
    body:JSON.stringify({ password:p1 })
  })
  .then(res=>res.json())
  .then(data=>{
    if(data.status==="success"){
      Swal.fire({
        icon: "success",
        title: "Password Updated",
        text: "Your password has been updated successfully.",
        confirmButtonColor: "#28a745",
        allowOutsideClick: false
      });

      window.location.href="/";
    }else{
      Swal.fire({
        icon: "error",
        title: "Reset Failed",
        text: "Unable to reset password. Please try again.",
        confirmButtonColor: "#dc3545",
        allowOutsideClick: false
      });
    }
  });
}

  </script>

</body>
</html>
