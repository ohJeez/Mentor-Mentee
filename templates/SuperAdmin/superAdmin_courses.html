{% load static %}
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Super Admin | Courses</title>

    <link rel="stylesheet" href="{% static 'styles/admin.css' %}">
    <style>
        body {
            background:#f4f7fb;
            font-family: Poppins, sans-serif;
        }

        .content {
            margin-left: 320px;
            padding: 40px;
        }

        h2 {
            font-size: 28px;
            font-weight: 700;
            margin-bottom: 20px;
        }

        .row {
            display: flex;
            justify-content: space-between;
            width: 80%;
            margin-bottom: 20px;
        }

        select {
            padding: 10px;
            border-radius: 6px;
            border:1px solid #ccc;
        }

        .addBtn {
            background:#199644;
            color:white;
            padding:10px 16px;
            border:none;
            border-radius:8px;
            cursor:pointer;
            font-weight:600;
        }

        .table-box {
            width:80%;
            background:white;
            padding:20px;
            border-radius: 12px;
            box-shadow:0 3px 10px rgba(0,0,0,0.08);
        }

        table {
            width:100%;
            border-collapse: collapse;
        }

        th {
            background:#199644;
            color:white;
            padding:14px;
            font-size:15px;
        }

        td {
            padding:14px;
            border-bottom:1px solid #eee;
        }

        .popup {
            position: fixed;
            top:0; left:0;
            width:100%; height:100%;
            background:rgba(0,0,0,0.4);
            display:none;
            justify-content:center;
            align-items:center;
        }

        .popup-content {
            background:white;
            width:400px;
            padding:25px;
            border-radius:10px;
        }

        .popup-input {
            width:100%;
            padding:10px;
            border:1px solid #ccc;
            border-radius:6px;
            margin-bottom:10px;
        }

        .saveBtn {
            background:#199644;
            padding:10px 15px;
            border:none;
            color:white;
            border-radius:6px;
            cursor:pointer;
        }

        .cancelBtn {
            background:#777;
            padding:10px 15px;
            border:none;
            color:white;
            border-radius:6px;
            cursor:pointer;
        }
    </style>
</head>

<body>

{% include 'SuperAdmin/superAdmin_header_sidebar.html' %}

<div class="content">

    <h2>Courses</h2>

    <div class="row">
        <select id="deptSelect" onchange="loadCourses()">
            <option value="">Select Department</option>
            {% for d in departments %}
            <option value="{{ d.dept_id }}">{{ d.name }}</option>
            {% endfor %}
        </select>

        <button class="addBtn" onclick="openForm()">+ Add Course</button>
    </div>

    <div class="table-box">
        <table>
            <thead>
            <tr>
                <th>Course Name</th>
                <th>Department</th>
                <th>Actions</th>
            </tr>
            </thead>
            <tbody id="courseBody"></tbody>
        </table>
    </div>

</div>

<!-- Popup Form -->
<div class="popup" id="popupForm">
    <div class="popup-content">

        <h3 id="formTitle">Add Course</h3>

        <form action="{% url 'superAdmin_save_course' %}" method="post">
            {% csrf_token %}

            <input type="hidden" id="courseId" name="id">

            <label>Department</label>
            <select name="department_id" class="popup-input" id="deptField">
                {% for d in departments %}
                <option value="{{ d.dept_id }}">{{ d.name }}</option>
                {% endfor %}
            </select>

            <label>Course Name</label>
            <input type="text" name="course_name" id="courseName" class="popup-input" required>

            <button class="saveBtn">Save</button>
            <button type="button" class="cancelBtn" onclick="closeForm()">Cancel</button>
        </form>

    </div>
</div>

<script>
    function loadCourses() {
        const deptId = document.getElementById("deptSelect").value;
        if (!deptId) return;

        fetch(`/superAdmin_get_courses/${deptId}/`)
            .then(res => res.json())
            .then(data => {
                let html = "";
                data.forEach(d => {
                    html += `
                    <tr>
                        <td>${d.course_name}</td>
                        <td>${d.department_name}</td>
                        <td>
                            <button onclick="editCourse(${d.course_id}, '${d.course_name}', ${d.department_id})">Edit</button>
                            <a href="/superAdmin_delete_course/${d.course_id}">Delete</a>
                        </td>
                    </tr>`;
                });
                document.getElementById("courseBody").innerHTML = html;
            });
    }

    function openForm() {
        document.getElementById("popupForm").style.display = "flex";
        document.getElementById("formTitle").innerText = "Add Course";
        document.getElementById("courseId").value = "";
        document.getElementById("courseName").value = "";
    }

    function editCourse(id, name, dept) {
        document.getElementById("popupForm").style.display = "flex";
        document.getElementById("formTitle").innerText = "Edit Course";

        document.getElementById("courseId").value = id;
        document.getElementById("courseName").value = name;
        document.getElementById("deptField").value = dept;
    }

    function closeForm() {
        document.getElementById("popupForm").style.display = "none";
    }
</script>

</body>
</html>
